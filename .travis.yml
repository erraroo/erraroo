language: go
go:
- 1.4.2
addons:
  postgresql: 9.3
env:
  matrix:
  - AWS_REGION=us-east-1
  global:
  - secure: bd3901lw7TdgBVugfDfDOWC6MHR7VvpdCyHmpER7s1F913fnwUbuVSg1PNKeps/IEUoV31zE5+Cakq0EPACsLInnlTRgCSha9z6eFmCL7q9O+d87dMXHH7nBHmqRzfWHyqGBusgZQCmDTfTRFrgAl9yp4RAL3Yr+tmGMzNHvRTotFkGsuRnDGxG2c0K8oNFDgq6wzpd2BjYsUf9RUoRHNJd1Gc4aEKxkvsTmcWhvj/cTpb0Il2+Z2hsZzGRQf/rZY7jjpa0WMtCY95HikgkkXb/uq0EfgOKewuUpyIAQahfkCooTtfYTcbjK+XGMJrmwBZhqAgGQGoV9khB50RoPVDi66ZuqpNb70jASOPNgsj3VwNIurqADUblj+ECYpgO1YHm+ndJsZABxXDMvOipidyplk4r106h3ZshCDlCTDcld0yrPVYTe1Bo8PvDRzjvC0vFbz1roN1mWzditq9Fr9olVjtozMG38WCw1shsEDvuCD+2eef1fhYihLz1BgW+MdJUilQJaae1hUEUtWYDur3Z1bMSlsLXbLGMB35UQAl1sR+LmyCAyx2PVDu+exrQp3Hvq0kw9SQsy3pyQ1PL/LX9GXThz7DpPKAjy0opdgxABUO0iewISy1q2alr88BwdnKYlwL86Qn2PCihBrpWf2C/MkQJG9v9GTaVV1w3uwXY=
  - secure: peXNX/H3nylbyiA3PDmpDt0QFzYMBQEluTccx1uq/qB8E6fXIdbWjWcH/C1popXNmvgzmd799eezRESIRU3mEfYQWgA7GpnuoYr1VQB6cQ1ZY2v3RkSCiBtv0fgorRRsc7NftkD0pp1nB1dRrHFlUfYvtxGoqBibXZ5iWUa/zV58yU+s1gKIOrKeA0nYJFmM0Ddb9jjnaCnFMVN7D+1yXHdV4atULHUw04UIPYhtmxiqKpsqHR2Jqfj8mCGWonUtxDIaNs8u7X6Vtak8h5vcZ9aAHuioci9/DoggvzfFLo8RjcgtkIXuc/9HJtIgMutfPyr1HUpTlcTJgUplphO0WUrzLxC3sVqwkOprmtfsk2uNu2l+NuNMUJVMwDshcHcUA7iX3KTfFWdns4p9N44kNLCz4nqMIpBMb4iBxCQCaHmo831sYlgBBd+eMomaZ59p+YQqTuMi+vf1KobzMF/bPkTv0PAGHowMWzbdCHjZDFKWLNTYm2FROS3wbdI5peVaFhPCYsFmBLEfOf9TXMTDMpB+oiuTVnKyeR+/97gOTrWEOzK2d14uFLmzdcdoM9EqZ4I4im6YUNHAK1BjeBrDjQPo7xlAWO+nWjM7LPH1qmA2vrL4ccNPL4mVu/DkOahnfLA2AsmGD/rv5/gL30VUEqy9LLSWI+YdNv4SzWNxzoY=
services:
- postgresql
- redis-server
install:
- go get -d ./...
- go get -u github.com/stretchr/testify/assert
before_script:
- scripts/ci
script: go test ./...
after_success:
- go build .
- mkdir $HOME/dist
- mv erraroo $HOME/dist/
- tar czfv $HOME/dist/migrations.tar.gz db/migrations/*
deploy:
  provider: s3
  access_key_id: AKIAJBP3D3DM4VFVUFZQ
  secret_access_key:
    secure: YDQISBHAkbPiTd3nUfA5X5AcPlwUg5h/pwyxxykGYM4VeUAWwBUzASzu09itnpOmlLMO0OH/tDqWfZFoocMIdUfZQLqiwZBeDp9XnFTO2J1wkIeeGSz0Lxja8KP3cFHgu1ZEdBT8Q2543trQtAMe94k0zmn8iwpNtkarkN4E7hUz8DGPXcaCoU+0DoY/hJxs9Y0in1PW+UMcHQfvPB30mWd22rcMrRgOO+sR6C8Vl/FGe4tlnCVzyJo0KBHFaqVPBvuK0KXbn6iNaVvwUE4NFNJzXKkyMkddtE7i0qT3tmVK6nJVrkVG8+qJVhpWraJRueQROFfKO66H/N7txR04CHkrCGO2c74DovqxxetUwnMvdzI6YVMPQSh1v8sHF6EaMX/W7ZDmJwEdesY/oDiX700wkIiZzN76YrCt5GeqbEtfZhLTX8mKlVX2TXxwTTaOGRg6UxtKmZ1gZdrlwhmk3KL6WRi2r2wrBDVnMm/1OXybhW9qBaCNd2MLHFdC5tpePIZ2uGVPj5RTzHorC8hakqs/save9mcYL3J7FyVt5TCDAdGpXv8iqLxMM7kHZL9YzLu9WYBIETiA8auXev7g8vffU+hLcsS9yh66CTSsZi+F3BF3hnDkWsEQAgP/vJ4CUr9k2uMdgwJUsbpUJMWofEI2A5huWC72KsEqdY9XUik=
  bucket: builds.erraroo.com
  local_dir: "$HOME/dist"
  upload-dir: "$TRAVIS_BRANCH"
  acl: private
  on:
    repo: erraroo/erraroo
